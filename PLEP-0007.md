# PLEP-0007 -- Optional Dependencies

| PLEP              | 7                                        |
|-------------------|------------------------------------------|
| title             | Optional dependencies                    |
| author(s)         | Dominik StaÅ„czak                         |
| contact email     | stanczakdominik@gmail.com                |
| date created      | 2018-08-22                               |
| date last revised | 2018-08-22                               |
| type              | informational                            |
| status            | discussion                               |

As PlasmaPy grows in terms of size and different subpackages specialize, it will
require more and more complex dependencies to function. As things stand at the
time of this PLEP's writing, this will mean installing more and more complex,
often C/Fortran based packages that not everyone will be likely to use.

The use case that provoked this PLEP is needing to calculate a few plasma
quantities using the `plasmapy.physics` subpackage, which has a rather minimal
set of dependencies. However, as `plasmapy.classes.hdf5` runs on the
C/C++/Cython based `h5py` package, that needs to be installed even if the user
intends never to use that functionality.

From a design standpoint, there are two obvious, broad possible solutions to
this issue:

1. Consciously decide to keep all dependencies required
2. Make several of the dependencies optional

# David's and Stuart's good discussion on Matrix

link here

# Other scientific packages' approach to dependencies

# Technical considerations for making dependencies optional

From a technical standpoint, it is not difficult to turn a bunch of dependencies
optional. However, PlasmaPy's current setup makes that a little more complicated.

Consider this part of `plasmapy/__init__.py`:
```python
INITPY HERE
```

This module loads every single subpackage of PlasmaPy at the same time, and

# Technical considerations for keeping dependencies required

Inevitably we are going to encounter systems which do not support some package.

# How to time an import statement?

# Our current requirements.txt file
As it stands, our `requirements.txt` file looks like this:
```
numpy (>= 1.13)
scipy (>= 0.19)
astropy (>= 2.0)
mpmath (>= 1.0.0)
h5py (>= 2.8)
lmfit (>= 0.9.7)
matplotlib (>= 2.0)
cython (>= 0.27.2)
colorama (>= 0.3)
```

Of those packages the following are good candidates for required packages:

* `astropy` is imported 88 times, mostly for the `units` subpackage.
* `import numpy` is seen 59 times, being a basic workhorse for numerical computation in Python. `numpy.pi` is also imported about 3 times.
* `scipy`'s `integrate`, `optimize`, `integrate` and `special` subpackages are imported 9 times.
* `cython` is not directly imported at all just yet, but is used at build/setup time and is, in all honesty, likely a question for a future PLEP.


And these could potentially become optional packages:
* `mpmath` is used once in `mathematics` for the polylogarithmic function.
* `h5py` is imported once in `classes.sources.openpmd_hdf5`.
* `lmfit` is imported once in `quantum` for a chemical potential minimization calculation.
* `matplotlib` is imported for visualization functions in `species` and in `langmuir`. It is also broadly used in examples.
* `colorama` is used once in `pytest_helpers`.

# Summary
https://docs.pytest.org/en/latest/skipping.html
